–§–∞–π–ª `daemon.json` ‚Äî —ç—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª Docker-–¥–µ–º–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏. –û–Ω –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –ø—É—Ç–∏:

- **Linux**: `/etc/docker/daemon.json`
- **Windows (Docker Desktop)**: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ GUI –∏–ª–∏ WSL2
- **macOS (Docker Desktop)**: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, —á–µ—Ä–µ–∑ GUI

---

### –ü—Ä–∏–º–µ—Ä `daemon.json`

```json
{
  "debug": true,
  "log-level": "info",
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  },
  "storage-driver": "overlay2",
  "insecure-registries": [
    "my-registry.local:5000"
  ],
  "registry-mirrors": [
    "https://mirror.gcr.io"
  ],
  "data-root": "/mnt/docker-data",
  "iptables": false,
  "live-restore": true,
  "default-ulimits": {
    "nofile": {
      "Name": "nofile",
      "Hard": 65536,
      "Soft": 65536
    }
  },
  "features": {
    "buildkit": true
  }
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `debug` | –í–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –¥–µ–º–æ–Ω–∞ |
| `log-level` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`debug`, `info`, `warn`, `error`, `fatal`) |
| `log-driver` | –î—Ä–∞–π–≤–µ—Ä –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ |
| `log-opts` | –û–ø—Ü–∏–∏ –¥–ª—è –¥—Ä–∞–π–≤–µ—Ä–∞ –ª–æ–≥–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤) |
| `storage-driver` | –î—Ä–∞–π–≤–µ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ –∏ —Å–ª–æ—ë–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `overlay2`) |
| `insecure-registries` | –°–ø–∏—Å–æ–∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Ä–µ–µ—Å—Ç—Ä–æ–≤ –±–µ–∑ HTTPS |
| `registry-mirrors` | –ó–µ—Ä–∫–∞–ª–∞ Docker Hub –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞–∑–æ–≤ |
| `data-root` | –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Docker (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/var/lib/docker`) |
| `iptables` | –û—Ç–∫–ª—é—á–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ iptables (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ! –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å —Å–µ—Ç—å) |
| `live-restore` | –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –¥–µ–º–æ–Ω–∞ |
| `default-ulimits` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| `features.buildkit` | –í–∫–ª—é—á–∞–µ—Ç BuildKit –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤ |

---

### –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª:
   ```bash
   sudo nano /etc/docker/daemon.json
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å JSON:
   ```bash
   sudo docker info  # –ø–æ–∫–∞–∂–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–Ω—Ñ–∏–≥–∞
   # –∏–ª–∏
   python3 -m json.tool /etc/docker/daemon.json
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker:
   ```bash
   sudo systemctl restart docker
   ```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π `daemon.json` –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞ Docker. –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –º–æ–≥—É –ø–æ–º–æ—á—å —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ –ø–æ–¥ –≤–∞—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —Ä–µ–µ—Å—Ç—Ä–∞, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞–º—è—Ç–∏, —Å–º–µ–Ω—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Ç.–¥.).


–í Docker **–¥–µ–º–æ–Ω (`dockerd`)** —Å–∞–º –ø–æ —Å–µ–±–µ **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é** (–≤—Ä–æ–¥–µ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API), –Ω–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø** –∫ Docker API. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞:

---

## üîê 1. **Docker Registry —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π** (—á–∞—Å—Ç–æ –ø—É—Ç–∞—é—Ç —Å –¥–µ–º–æ–Ω–æ–º)

–ï—Å–ª–∏ –≤—ã –∏–º–µ–µ—Ç–µ –≤ –≤–∏–¥—É **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º Docker Registry**, —Ç–æ –≤–æ—Ç –ø—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `daemon.json` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å **–∑–∞—â–∏—â—ë–Ω–Ω—ã–º —Ä–µ–µ—Å—Ç—Ä–æ–º**:

### ‚úÖ –ü—Ä–∏–º–µ—Ä `daemon.json` –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ registry —Å HTTPS –∏ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º:

```json
{
  "insecure-registries": [],
  "registry-mirrors": [],
  "tls": true,
  "tlscacert": "/etc/docker/certs.d/my-registry.local/ca.crt",
  "tlscert": "/etc/docker/certs.d/my-registry.local/client.cert",
  "tlskey": "/etc/docker/certs.d/my-registry.local/client.key"
}
```

> ‚ö†Ô∏è –≠—Ç–æ **–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –ª–æ–≥–∏–Ω—É/–ø–∞—Ä–æ–ª—é**, –∞ **TLS-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (mTLS). –î–ª—è –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞:
> ```bash
> docker login my-registry.local:5000
> ```
> –£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `~/.docker/config.json`.

---

## üîí 2. **–ó–∞—â–∏—Ç–∞ Docker API (–¥–µ–º–æ–Ω–∞) —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π**

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Docker API –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Unix-—Å–æ–∫–µ—Ç (`/var/run/docker.sock`). –ï—Å–ª–∏ –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –µ–≥–æ –ø–æ TCP (–Ω–∞–ø—Ä–∏–º–µ—Ä, `tcp://0.0.0.0:2375`), **—ç—Ç–æ –∫—Ä–∞–π–Ω–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ –±–µ–∑ –∑–∞—â–∏—Ç—ã**.

### üîß –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TLS + TCP –≤ `daemon.json`

```json
{
  "hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2376"],
  "tls": true,
  "tlscacert": "/etc/docker/ca.pem",
  "tlscert": "/etc/docker/server-cert.pem",
  "tlskey": "/etc/docker/server-key.pem",
  "tlsverify": true
}
```

> –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç **—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤**, –Ω–æ **–Ω–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å**.

### üîê –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Nginx)

Docker **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTTP Basic Auth –∏–ª–∏ JWT –Ω–∞–ø—Ä—è–º—É—é**, –ø–æ—ç—Ç–æ–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å **–æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏** (Nginx, Traefik –∏ —Ç.–ø.).

#### –ü—Ä–∏–º–µ—Ä Nginx –∫–æ–Ω—Ñ–∏–≥–∞ —Å Basic Auth:

```nginx
server {
    listen 2377 ssl;
    server_name docker-api.example.com;

    ssl_certificate /path/to/fullchain.pem;
    ssl_certificate_key /path/to/privkey.pem;

    auth_basic "Docker API";
    auth_basic_user_file /etc/nginx/.htpasswd;

    location / {
        proxy_pass http://unix:/var/run/docker.sock;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.htpasswd`:
```bash
sudo htpasswd -c /etc/nginx/.htpasswd admin
```

–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø –∫ API –±—É–¥–µ—Ç –ø–æ:
```
https://docker-api.example.com:2377
```
—Å –ª–æ–≥–∏–Ω–æ–º –∏ –ø–∞—Ä–æ–ª–µ–º.

> üí° –ö–ª–∏–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `curl` –∏–ª–∏ CI/CD) –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
> ```bash
> curl -u admin:password https://docker-api.example.com:2377/v1.41/containers/json
> ```

---

## üõ°Ô∏è –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Docker Socket Proxy** –∏–ª–∏ **Auth Proxy**

- [**Tecnativa/docker-socket-proxy**](https://github.com/Tecnativa/docker-socket-proxy) ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∞, –Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏–Ω.
- [**authelia**, **oauth2-proxy**, **Traefik + middleware**] ‚Äî –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

---

## ‚ùå –ß—Ç–æ –ù–ï–õ–¨–ó–Ø —Å–¥–µ–ª–∞—Ç—å –≤ `daemon.json`:

- –£–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –Ω–∞–ø—Ä—è–º—É—é.
- –í–∫–ª—é—á–∏—Ç—å HTTP Basic Auth –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –ø—Ä–æ–∫—Å–∏.
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ IP (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `iptables` –∏–ª–∏ –ø—Ä–æ–∫—Å–∏).

---

## ‚úÖ –†–µ–∑—é–º–µ

| –ó–∞–¥–∞—á–∞ | –†–µ—à–µ–Ω–∏–µ |
|-------|--------|
| –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ **–ø—Ä–∏–≤–∞—Ç–Ω–æ–º registry** | `docker login`, `~/.docker/config.json` |
| –ó–∞—â–∏—Ç–∞ **Docker API** | TLS + –ø—Ä–æ–∫—Å–∏ (Nginx/Traefik) —Å Basic Auth –∏–ª–∏ OAuth |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `daemon.json` | –¢–æ–ª—å–∫–æ TLS, —Ö–æ—Å—Ç—ã, –ª–æ–≥–∏, storage –∏ —Ç.–ø. |

---

–ï—Å–ª–∏ –≤—ã —É—Ç–æ—á–Ω–∏—Ç–µ, **—á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞—â–∏—Ç–∏—Ç—å**:
- –¥–æ—Å—Ç—É–ø –∫ `docker pull/push` –≤ —Å–≤–æ–π registry?
- —É–¥–∞–ª—ë–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ `docker run` —á–µ—Ä–µ–∑ API?

‚Äî —è –¥–∞–º —Ç–æ—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.


–û—Ç–ª–∏—á–Ω–æ! –†–∞–∑–±–µ—Ä—ë–º –æ–±–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Ä–µ—à–∞—é—Ç—Å—è **–ø–æ-—Ä–∞–∑–Ω–æ–º—É**.

---

## üîê –°—Ü–µ–Ω–∞—Ä–∏–π 1: **–î–æ—Å—Ç—É–ø –∫ `docker pull/push` –≤ —Å–≤–æ–π registry**  
(–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å **–ø—Ä–∏–≤–∞—Ç–Ω—ã–º Docker Registry**)

### ‚úÖ –¶–µ–ª—å:
–ß—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ **–Ω–µ –º–æ–≥–ª–∏** –¥–µ–ª–∞—Ç—å `docker pull` –∏–ª–∏ `docker push` –±–µ–∑ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è.

### üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ:
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Docker Registry v2 —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `htpasswd` –∏–ª–∏ OAuth).

---

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π registry —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

–ü—Ä–∏–º–µ—Ä —Å **HTTP Basic Auth** —á–µ—Ä–µ–∑ `htpasswd`:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
docker run --entrypoint htpasswd httpd:2 -Bbn myuser mypassword > auth/htpasswd

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ registry
docker run -d \
  --name registry \
  -v "$(pwd)/auth:/auth" \
  -v "$(pwd)/certs:/certs" \
  -e "REGISTRY_AUTH=htpasswd" \
  -e "REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm" \
  -e "REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd" \
  -e "REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt" \
  -e "REGISTRY_HTTP_TLS_KEY=/certs/domain.key" \
  -p 5000:5000 \
  registry:2
```

> üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–≤–∞–ª–∏–¥–Ω—ã–π TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** (Let's Encrypt –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π CA). –ò–Ω–∞—á–µ –ø—Ä–∏–¥—ë—Ç—Å—è —É–∫–∞–∑—ã–≤–∞—Ç—å `insecure-registries`.

---

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `daemon.json` –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –º–∞—à–∏–Ω–∞—Ö

–ï—Å–ª–∏ registry –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (HTTPS)** ‚Äî `daemon.json` **–Ω–µ –Ω—É–∂–µ–Ω**.  
–ï—Å–ª–∏ **—Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** ‚Äî –¥–æ–±–∞–≤—å—Ç–µ:

```json
{
  "insecure-registries": [],
  "registry-mirrors": []
}
```

> ‚ùå –ù–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –≤ `daemon.json` **–Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è**!

---

### –®–∞–≥ 3: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```bash
docker login my-registry.local:5000
# –í–≤–æ–¥–∏—Ç: myuser / mypassword
```

–£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `~/.docker/config.json`.

–¢–µ–ø–µ—Ä—å:
```bash
docker pull my-registry.local:5000/myimage
docker push my-registry.local:5000/myimage
```

‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π.

---

## üîê –°—Ü–µ–Ω–∞—Ä–∏–π 2: **–£–¥–∞–ª—ë–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ `docker run` —á–µ—Ä–µ–∑ API**  
(–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤—Ä–æ–¥–µ `docker run`, `docker ps` —á–µ—Ä–µ–∑ HTTP API)

### ‚ö†Ô∏è –í–∞–∂–Ω–æ:
–≠—Ç–æ **–æ—á–µ–Ω—å –æ–ø–∞—Å–Ω–æ**, –µ—Å–ª–∏ –Ω–µ –∑–∞—â–∏—Ç–∏—Ç—å –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º. API –¥–∞—ë—Ç **–ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** –Ω–∞–¥ —Ö–æ—Å—Ç–æ–º!

---

### ‚úÖ –¶–µ–ª—å:
–†–∞–∑—Ä–µ—à–∏—Ç—å —É–¥–∞–ª—ë–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker —á–µ—Ä–µ–∑ API, –Ω–æ **—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º**.

### üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ:
Docker **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –Ω–∞–ø—Ä—è–º—É—é**, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º **TLS + –ø—Ä–æ–∫—Å–∏ —Å Basic Auth**.

---

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `daemon.json` ‚Äî –≤–∫–ª—é—á–∏—Ç—å TCP + TLS

```json
{
  "hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2376"],
  "tls": true,
  "tlsverify": true,
  "tlscacert": "/etc/docker/ca.pem",
  "tlscert": "/etc/docker/server-cert.pem",
  "tlskey": "/etc/docker/server-key.pem"
}
```

> –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤**, –Ω–æ **–Ω–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å**.

---

### –®–∞–≥ 2: (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–±–∞–≤–∏—Ç—å Nginx —Å Basic Auth –ø–æ–≤–µ—Ä—Ö —Å–æ–∫–µ—Ç–∞

–ï—Å–ª–∏ –≤—ã **–Ω–µ —Ö–æ—Ç–∏—Ç–µ –≤–æ–∑–∏—Ç—å—Å—è —Å TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏**, –º–æ–∂–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å **–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–æ–∫–µ—Ç** —á–µ—Ä–µ–∑ Nginx —Å –ø–∞—Ä–æ–ª–µ–º:

#### `nginx.conf`:
```nginx
server {
    listen 2377 ssl;
    server_name _;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    auth_basic "Docker API";
    auth_basic_user_file /etc/nginx/.htpasswd;

    location / {
        proxy_pass http://unix:/var/run/docker.sock;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

–°–æ–∑–¥–∞–π—Ç–µ `.htpasswd`:
```bash
htpasswd -c /etc/nginx/.htpasswd admin
```

–¢–µ–ø–µ—Ä—å API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ:  
`https://your-server:2377`

---

### –®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Nginx (Basic Auth)
```bash
curl -u admin:password https://your-server:2377/v1.43/containers/json
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ TLS (–±–µ–∑ –ø–∞—Ä–æ–ª—è, –Ω–æ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏)
```bash
curl \
  --cacert ca.pem \
  --cert client-cert.pem \
  --key client-key.pem \
  https://your-server:2376/v1.43/containers/json
```

> –î–ª—è `docker` CLI –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API –Ω–∞–ø—Ä—è–º—É—é **–Ω–µ–ª—å–∑—è** ‚Äî –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Å–æ–∫–µ—Ç–æ–º –∏–ª–∏ TLS-—Ö–æ—Å—Ç–æ–º.  
> –ù–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DOCKER_HOST`:
> ```bash
> export DOCKER_HOST=tcp://your-server:2376
> export DOCKER_TLS_VERIFY=1
> export DOCKER_CERT_PATH=/path/to/certs
> docker ps
> ```

---

## üìå –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | –§–∞–π–ª `daemon.json` –Ω—É–∂–µ–Ω? |
|--------|-------------------------------|---------------------------|
| **`docker pull/push` –≤ —Å–≤–æ–π registry** | –í —Å–∞–º–æ–º **registry** (—á–µ—Ä–µ–∑ `REGISTRY_AUTH`) | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ registry –±–µ–∑ HTTPS (`insecure-registries`) |
| **–£–¥–∞–ª—ë–Ω–Ω—ã–π `docker run` —á–µ—Ä–µ–∑ API** | –ß–µ—Ä–µ–∑ **Nginx/Traefik** –∏–ª–∏ **TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** | –î–∞ ‚Äî —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å TCP –∏ TLS |

---

## üîí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –ø–æ—Ä—Ç 2375 –±–µ–∑ TLS** ‚Äî —ç—Ç–æ –¥–∞—ë—Ç root-–¥–æ—Å—Ç—É–ø –ª—é–±–æ–º—É –≤ —Å–µ—Ç–∏.
2. –î–ª—è registry –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **HTTPS + –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é**.
3. –î–ª—è API ‚Äî –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **mTLS (—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)**, —á–µ–º Basic Auth.
4. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –ø–æ IP —á–µ—Ä–µ–∑ `iptables` –∏–ª–∏ —Ñ–∞–µ—Ä–≤–æ–ª.

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –º–æ–≥—É –¥–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π `docker-compose.yml` –¥–ª—è registry —Å auth –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥ Nginx —Ü–µ–ª–∏–∫–æ–º.