# Настройка rsync для копирования файлов между папками при изменениях

Rsync - отличный инструмент для синхронизации файлов между папками с минимальными затратами ресурсов, так как он копирует только измененные файлы.

## Базовый пример синхронизации

```bash
rsync -avz --delete /исходная/папка/ /целевая/папка/
```

Где:
- `-a` - архивный режим (сохраняет права, владельца, временные метки и т.д.)
- `-v` - вывод информации о процессе
- `-z` - сжатие данных при передаче
- `--delete` - удаляет файлы в целевой папке, которых нет в исходной

## Мониторинг изменений и автоматическая синхронизация

### Вариант 1: Использование inotifywait (требует установки inotify-tools)

```bash
while inotifywait -r -e modify,create,delete,move /исходная/папка; do
  rsync -avz --delete /исходная/папка/ /целевая/папка/
done
```

### Вариант 2: Использование cron для периодической проверки

Добавьте в crontab (crontab -e):
```bash
* * * * * rsync -avz --delete /исходная/папка/ /целевая/папка/
```

### Вариант 3: Использование systemd (для Linux)

Создайте сервисный файл `/etc/systemd/system/sync.service`:
```
[Unit]
Description=Folder sync service

[Service]
ExecStart=/usr/bin/inotifywait -m -r -e modify,create,delete,move --format "%w%f" /исходная/папка/ | while read FILE; do rsync -avz --delete /исходная/папка/ /целевая/папка/; done
Restart=always
```

Затем активируйте сервис:
```bash
systemctl daemon-reload
systemctl start sync.service
systemctl enable sync.service
```

## Дополнительные параметры rsync

- `--exclude='*.tmp'` - исключить файлы по шаблону
- `--progress` - показывать прогресс копирования
- `--dry-run` - тестовый запуск без реального копирования
- `--bwlimit=1000` - ограничить скорость передачи (в KB/s)

Для более сложных сценариев можно рассмотреть использование `lsyncd` - демона, который объединяет inotify и rsync.