–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ **—Å –æ–¥–Ω–æ–≥–æ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (Server A) –Ω–∞ –¥—Ä—É–≥–æ–π —É–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (Server B)** —Å –ø–æ–º–æ—â—å—é `rsync`, –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤.  

---

## üîπ **–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é –º–∞—à–∏–Ω—É (–≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π –ü–ö)**  
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–±–æ–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫—É—é —Å—Ö–µ–º—É:  

```bash
rsync -avz -e "ssh -p PORT_A" user@server_a:/path/to/source/ \
      -e "ssh -p PORT_B" user@server_b:/path/to/destination/
```
**–ü—Ä–∏–º–µ—Ä:**  
```bash
rsync -avz -e "ssh -p 22" admin@111.111.111.111:/var/www/ \
      -e "ssh -p 2222" backup@222.222.222.222:/backups/www/
```
**–ú–∏–Ω—É—Å:** –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ.  

---

## üîπ **–°–ø–æ—Å–æ–± 2: –ü—Ä—è–º–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏ (SSH-—Ç–æ–Ω–Ω–µ–ª—å)**  
–ï—Å–ª–∏ **Server B** –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ **Server A**, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É **–Ω–∞ Server B**:  

```bash
rsync -avz -e "ssh -p PORT_A" user@server_a:/path/to/source/ /path/to/destination/
```
**–ü—Ä–∏–º–µ—Ä:**  
```bash
rsync -avz -e "ssh -p 22" admin@111.111.111.111:/var/www/ /backups/www/
```
**–ú–∏–Ω—É—Å:** —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–∞ **—Å Server B –Ω–∞ Server A**.  

---

## üîπ **–°–ø–æ—Å–æ–± 3: –î–≤–æ–π–Ω–æ–π SSH-—Ç–æ–Ω–Ω–µ–ª—å (–µ—Å–ª–∏ Server A –∏ Server B –Ω–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞)**  
–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä—ã **–Ω–µ –∏–º–µ—é—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞**, –Ω–æ —É –≤–∞—Å –µ—Å—Ç—å SSH-–¥–æ—Å—Ç—É–ø –∫ –æ–±–æ–∏–º:  

1. **–°–æ–∑–¥–∞—ë–º SSH-—Ç–æ–Ω–Ω–µ–ª—å —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É** (–ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Ä—Ç):  
   ```bash
   ssh -L 33000:server_b:22 user@server_a
   ```
2. **–ù–∞ Server A –≤—ã–ø–æ–ª–Ω—è–µ–º rsync —á–µ—Ä–µ–∑ –ø—Ä–æ–±—Ä–æ—à–µ–Ω–Ω—ã–π –ø–æ—Ä—Ç**:  
   ```bash
   rsync -avz -e "ssh -p 33000" /path/to/source/ user@localhost:/path/to/destination/
   ```
   (–¥–∞–Ω–Ω—ã–µ –ø–æ–π–¥—É—Ç —á–µ—Ä–µ–∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π SSH-–∫–∞–Ω–∞–ª).  

---

## üîπ **–°–ø–æ—Å–æ–± 4: Rsync —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç**  
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **SSH + Rsync –≤ –æ–¥–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ**:  

```bash
#!/bin/bash
SOURCE="user@server_a:/path/to/source/"
DEST="user@server_b:/path/to/destination/"
TEMP_DIR="/tmp/rsync_temp/"

# –°–∫–∞—á–∏–≤–∞–µ–º —Å Server A –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
rsync -avz -e "ssh -p 22" "$SOURCE" "$TEMP_DIR"

# –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ Server B
rsync -avz -e "ssh -p 2222" "$TEMP_DIR" "$DEST"

# –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
rm -rf "$TEMP_DIR"
```

---

## üîπ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ Rsync**  
- `-z` ‚Äì —Å–∂–∞—Ç–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ (—É–º–µ–Ω—å—à–∞–µ—Ç —Ç—Ä–∞—Ñ–∏–∫).  
- `--progress` ‚Äì –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.  
- `--delete` ‚Äì —É–¥–∞–ª—è–µ—Ç –≤ destination —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ source.  
- `--exclude="*.log"` ‚Äì –∏—Å–∫–ª—é—á–∞–µ—Ç —Ñ–∞–π–ª—ã –ø–æ –º–∞—Å–∫–µ.  

**–ü—Ä–∏–º–µ—Ä —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏:**  
```bash
rsync -avz --progress --delete --exclude="*.tmp" \
      -e "ssh -p 22" admin@server_a:/data/ \
      -e "ssh -p 2222" backup@server_b:/backup/data/
```

---

### ‚ùó **–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã**  
1. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** ‚Äì —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ (Server A) –∏ –∑–∞–ø–∏—Å—å (Server B).  
2. **SSH-–∫–ª—é—á–∏** ‚Äì –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ –∫–ª—é—á–∞–º, –∞ –Ω–µ –ø–∞—Ä–æ–ª—é.  
3. **–°–∫–æ—Ä–æ—Å—Ç—å** ‚Äì –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏, –ª—É—á—à–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ü–ö).  

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **–±–µ—Å–ø–∞—Ä–æ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø** (`ssh-copy-id`) –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ ‚Äì —É—Ç–æ—á–Ω–∏—Ç–µ –¥–µ—Ç–∞–ª–∏! üöÄ


–í–æ—Ç —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤–∞—à–µ–≥–æ bash-—Å–∫—Ä–∏–ø—Ç–∞ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π:

```bash
#!/bin/bash

# –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ rsync

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
SOURCE="user@server_a:/path/to/source/"
DEST="user@server_b:/path/to/destination/"
TEMP_DIR="/tmp/rsync_temp_$(date +%Y%m%d_%H%M%S)"
SSH_OPTS_A="-e \"ssh -p 22 -o StrictHostKeyChecking=no -o ConnectTimeout=10\""
SSH_OPTS_B="-e \"ssh -p 2222 -o StrictHostKeyChecking=no -o ConnectTimeout=10\""
RSYNC_OPTS="-avz --progress --stats --human-readable --delete"
LOG_FILE="/var/log/rsync_transfer.log"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
error_exit() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] ERROR: $1" >> "$LOG_FILE"
    echo "ERROR: $1" >&2
    # –ü–æ–ø—ã—Ç–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    [ -d "$TEMP_DIR" ] && rm -rf "$TEMP_DIR"
    exit 1
}

# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
mkdir -p "$TEMP_DIR" || error_exit "Failed to create temp directory $TEMP_DIR"

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
echo "============================================" >> "$LOG_FILE"
echo "[$(date '+%Y-%m-%d %H:%M:%S')] Starting transfer" >> "$LOG_FILE"
echo "Source: $SOURCE" >> "$LOG_FILE"
echo "Destination: $DEST" >> "$LOG_FILE"
echo "Temp dir: $TEMP_DIR" >> "$LOG_FILE"

# –°–∫–∞—á–∏–≤–∞–µ–º —Å Server A –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
echo "[$(date '+%Y-%m-%d %H:%M:%S')] Downloading from source..." >> "$LOG_FILE"
rsync $RSYNC_OPTS $SSH_OPTS_A "$SOURCE" "$TEMP_DIR" >> "$LOG_FILE" 2>&1 || error_exit "Failed to download from source"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å —Ñ–∞–π–ª—ã
if [ -z "$(ls -A "$TEMP_DIR")" ]; then
    error_exit "Temp directory is empty after download"
fi

# –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ Server B
echo "[$(date '+%Y-%m-%d %H:%M:%S')] Uploading to destination..." >> "$LOG_FILE"
rsync $RSYNC_OPTS $SSH_OPTS_B "$TEMP_DIR" "$DEST" >> "$LOG_FILE" 2>&1 || error_exit "Failed to upload to destination"

# –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "[$(date '+%Y-%m-%d %H:%M:%S')] Cleaning up temp files..." >> "$LOG_FILE"
rm -rf "$TEMP_DIR" || error_exit "Failed to clean up temp directory"

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
echo "[$(date '+%Y-%m-%d %H:%M:%S')] Transfer completed successfully" >> "$LOG_FILE"
echo "============================================" >> "$LOG_FILE"

exit 0
```

–û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Ñ–∞–π–ª
2. –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å timestamp –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
4. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ñ–∞–π–ª—ã –±—ã–ª–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–∫–∞—á–∞–Ω—ã
5. –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –¥–ª—è rsync (--progress, --stats –∏ –¥—Ä.)
6. –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ SSH-–æ–ø—Ü–∏–∏ (—Ç–∞–π–º–∞—É—Ç—ã, –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ strict host checking)
7. –ß–∏—Å—Ç—ã–π –≤—ã—Ö–æ–¥ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∫–æ–¥–∞–º–∏
8. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
9. –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. –î–ª—è –±–æ–ª—å—à–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH-–∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π
2. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
3. –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º –ø–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
4. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é —Å–∫—Ä–∏–ø—Ç–∞ —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
5. –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –¥–æ–±–∞–≤–∏–ª –∫–∞–∫–∏–µ-—Ç–æ –∏–∑ —ç—Ç–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª —Å–∫—Ä–∏–ø—Ç –¥—Ä—É–≥–∏–º –æ–±—Ä–∞–∑–æ–º?